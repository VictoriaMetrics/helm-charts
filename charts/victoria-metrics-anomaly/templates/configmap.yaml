{{- if not .Values.config.reader.tenant_id -}}
  {{- $ := unset .Values.config.reader "tenant_id" }}
{{- end -}}

{{- if not .Values.config.writer.tenant_id -}}
  {{- $ := unset .Values.config.writer "tenant_id" }}
{{- end -}}

{{- $ctx := dict "helm" . }}
{{- $fullname := include "vm.fullname" $ctx }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $fullname }}
  namespace: {{ include "vm.namespace" $ctx }}
  labels: {{- include "vm.labels" $ctx | nindent 4 }}
  {{- with .Values.configMapAnnotations }}
  annotations: {{ toYaml . | nindent 10 }}
  {{- end }}
data:
  config.yml: |{{ toYaml (.Values.config | default dict) | nindent 4 }}
