
{{- $Values := (.helm).Values | default .Values }}
{{- $multicluster := ((($Values.grafana).sidecar).dashboards).multicluster | default false }}
{{- $defaultDatasource := "prometheus" -}}
{{- $clusterLabel := ($Values.global).clusterLabel | default "cluster" }}
{{- range (($Values.defaultDatasources).victoriametrics).datasources | default list }}
  {{- if and .isDefault .type }}{{ $defaultDatasource = .type }}{{- end }}
{{- end }}
title: Grafana Overview
templating:
  list:
  - name: datasource
    type: datasource
    query: {{ $defaultDatasource }}
    hide: 0
    current:
      selected: true
      text: dev-cortex
      value: dev-cortex
    description: null
    error: null
    options: []
    queryValue: ""
    refresh: 1
    regex: ""
    skipUrlSync: false
  - name: job
    multi: true
    includeAll: true
    datasource: $datasource
    type: query
    query:
      query: label_values(grafana_build_info, job)
      refId: Billing Admin-job-Variable-Query
    definition: label_values(grafana_build_info, job)
    hide: 0
    allValue: .*
    current:
      selected: false
      text:
      - default/grafana
      value:
      - default/grafana
    description: null
    error: null
    options: []
    refresh: 1
    regex: ""
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ""
    tagsQuery: ""
    useTags: false
  - name: instance
    multi: true
    includeAll: true
    datasource: $datasource
    type: query
    query:
      query: label_values(grafana_build_info, instance)
      refId: Billing Admin-instance-Variable-Query
    definition: label_values(grafana_build_info, instance)
    hide: 0
    allValue: .*
    current:
      selected: false
      text: All
      value: $__all
    description: null
    error: null
    options: []
    refresh: 1
    regex: ""
    skipUrlSync: false
    sort: 0
    tagValuesQuery: ""
    tagsQuery: ""
    useTags: false
  - name: cluster
    label: cluster
    multi: {{ ternary true false $multicluster }}
    includeAll: {{ ternary true false $multicluster }}
    datasource:
      type: {{ $defaultDatasource }}
    type: {{ ternary "query" "constant" $multicluster }}
    query: {{ ternary (printf "label_values(grafana_build_info, %s)" $clusterLabel) ".*" $multicluster }}
    hide: {{ ternary 0 2 $multicluster }}
    allValue: .*
editable: false
timezone: {{ default "utc" ($Values.defaultDashboards).defaultTimezone }}
tags:
- vm-k8s-stack
annotations:
  list:
  - name: Annotations & Alerts
    datasource: -- Grafana --
    builtIn: 1
    enable: true
    hide: true
    iconColor: rgba(0, 211, 255, 1)
    target:
      limit: 100
      matchAny: false
      tags: []
      type: dashboard
    type: dashboard
panels:
- title: Firing Alerts
  targets:
  - expr: {{ printf "grafana_alerting_result_total{job=~\"$job\",instance=~\"$instance\",state=\"alerting\",%s=~\"$cluster\"}" $clusterLabel }}
    instant: true
    interval: ""
    legendFormat: ""
    refId: A
  datasource: $datasource
  fieldConfig:
    defaults:
      mappings: []
      noValue: "0"
      thresholds:
        mode: absolute
        steps:
        - color: green
          value: null
        - color: red
          value: 80
    overrides: []
  gridPos:
    h: 5
    w: 6
    x: 0
    "y": 0
  id: 6
  options:
    colorMode: value
    graphMode: area
    justifyMode: auto
    orientation: auto
    reduceOptions:
      calcs:
      - mean
      fields: ""
      values: false
    text: {}
    textMode: auto
  pluginVersion: 8.1.3
  timeFrom: null
  timeShift: null
  type: stat
- title: Dashboards
  targets:
  - expr: {{ printf "sum(grafana_stat_totals_dashboard{job=~\"$job\",instance=~\"$instance\",%s=~\"$cluster\"}) by(%s)" $clusterLabel $clusterLabel }}
    interval: ""
    legendFormat: ""
    refId: A
  datasource: $datasource
  fieldConfig:
    defaults:
      mappings: []
      thresholds:
        mode: absolute
        steps:
        - color: green
          value: null
        - color: red
          value: 80
    overrides: []
  gridPos:
    h: 5
    w: 6
    x: 6
    "y": 0
  id: 8
  options:
    colorMode: value
    graphMode: area
    justifyMode: auto
    orientation: auto
    reduceOptions:
      calcs:
      - mean
      fields: ""
      values: false
    text: {}
    textMode: auto
  pluginVersion: 8.1.3
  timeFrom: null
  timeShift: null
  type: stat
- title: Build Info
  targets:
  - expr: {{ printf "grafana_build_info{job=~\"$job\",instance=~\"$instance\",%s=~\"$cluster\"}" $clusterLabel }}
    instant: true
    interval: ""
    legendFormat: ""
    refId: A
  datasource: $datasource
  fieldConfig:
    defaults:
      custom:
        align: null
        displayMode: auto
      mappings: []
      thresholds:
        mode: absolute
        steps:
        - color: green
          value: null
        - color: red
          value: 80
    overrides: []
  gridPos:
    h: 5
    w: 12
    x: 12
    "y": 0
  id: 10
  options:
    showHeader: true
  pluginVersion: 8.1.3
  timeFrom: null
  timeShift: null
  transformations:
  - id: labelsToFields
    options: {}
  - id: organize
    options:
      excludeByName:
        Time: true
        Value: true
        branch: true
        container: true
        goversion: true
        namespace: true
        pod: true
        revision: true
      indexByName:
        Time: 7
        Value: 11
        branch: 4
        container: 8
        edition: 2
        goversion: 6
        instance: 1
        job: 0
        namespace: 9
        pod: 10
        revision: 5
        version: 3
      renameByName: {}
  type: table
- title: RPS
  targets:
  - expr: {{ printf "sum(irate(grafana_http_request_duration_seconds_count{job=~\"$job\",instance=~\"$instance\",%s=~\"$cluster\"}[1m])) by(status_code,%s)" $clusterLabel $clusterLabel }}
    interval: ""
    legendFormat: '{{`{{`}}status_code{{`}}`}}'
    refId: A
  datasource: $datasource
  aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 8
    w: 12
    x: 0
    "y": 5
  hiddenSeries: false
  id: 2
  legend:
    avg: false
    current: false
    max: false
    min: false
    show: true
    total: false
    values: false
  lines: true
  linewidth: 1
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.1.3
  pointradius: 2
  points: false
  renderer: flot
  seriesOverrides: []
  spaceLength: 10
  stack: true
  steppedLine: false
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:157
    format: reqps
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:158
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: false
  yaxis:
    align: false
    alignLevel: null
- title: Request Latency
  targets:
  - expr: {{ printf "histogram_quantile(0.99, sum(irate(grafana_http_request_duration_seconds_bucket{instance=~\"$instance\",job=~\"$job\",%s=~\"$cluster\"}[$__rate_interval])) by(le,%s)) * 1" $clusterLabel $clusterLabel }}
    exemplar: true
    interval: ""
    legendFormat: 99th Percentile
    refId: A
  - expr: {{ printf "histogram_quantile(0.50, sum(irate(grafana_http_request_duration_seconds_bucket{instance=~\"$instance\",job=~\"$job\",%s=~\"$cluster\"}[$__rate_interval])) by(le,%s)) * 1" $clusterLabel $clusterLabel }}
    exemplar: true
    interval: ""
    legendFormat: 50th Percentile
    refId: B
  - expr: {{ printf "(sum(irate(grafana_http_request_duration_seconds_sum{instance=~\"$instance\",job=~\"$job\",%s=~\"$cluster\"}[$__rate_interval])) by(%s) * 1) / sum(irate(grafana_http_request_duration_seconds_count{instance=~\"$instance\",job=~\"$job\",%s=~\"$cluster\"}[$__rate_interval])) by(%s)" $clusterLabel $clusterLabel $clusterLabel $clusterLabel }}
    exemplar: true
    interval: ""
    legendFormat: Average
    refId: C
  datasource: $datasource
  aliasColors: {}
  bars: false
  dashLength: 10
  dashes: false
  fieldConfig:
    defaults:
      links: []
    overrides: []
  fill: 1
  fillGradient: 0
  gridPos:
    h: 8
    w: 12
    x: 12
    "y": 5
  hiddenSeries: false
  id: 4
  legend:
    avg: false
    current: false
    max: false
    min: false
    show: true
    total: false
    values: false
  lines: true
  linewidth: 1
  nullPointMode: "null"
  options:
    alertThreshold: true
  percentage: false
  pluginVersion: 8.1.3
  pointradius: 2
  points: false
  renderer: flot
  seriesOverrides: []
  spaceLength: 10
  stack: false
  steppedLine: false
  thresholds: []
  timeFrom: null
  timeRegions: []
  timeShift: null
  tooltip:
    shared: true
    sort: 0
    value_type: individual
  type: graph
  xaxis:
    buckets: null
    mode: time
    name: null
    show: true
    values: []
  yaxes:
  - $$hashKey: object:210
    format: ms
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  - $$hashKey: object:211
    format: short
    label: null
    logBase: 1
    max: null
    min: null
    show: true
  yaxis:
    align: false
    alignLevel: null
condition: {{ ($Values.grafana).enabled }}
gnetId: null
graphTooltip: 0
id: 3085
iteration: 1.631554945276e+12
links: []
schemaVersion: 30
time:
  from: now-6h
  to: now
timepicker:
  refresh_intervals:
  - 10s
  - 30s
  - 1m
  - 5m
  - 15m
  - 30m
  - 1h
  - 2h
  - 1d
uid: 6be0s85Mk
version: 2
